name: Keep API Alive - Prevent Cold Starts

on:
  schedule:
    # Runs every 5 minutes
    - cron: '*/5 * * * *'
  workflow_dispatch: # Allows manual trigger from Actions tab

jobs:
  keep-alive:
    runs-on: ubuntu-latest
    timeout-minutes: 5
    
    steps:
      - name: Ping Health Endpoint
        run: |
          echo "ğŸ“ Pinging API at $(date)"
          response=$(curl -s -o /dev/null -w "%{http_code}" --max-time 30 https://claude-sonnet-api.onrender.com/health)
          
          if [ $response -eq 200 ]; then
            echo "âœ… API is alive! Status code: $response"
            echo "âš¡ Cold start prevented successfully"
          else
            echo "âš ï¸ API returned status: $response"
            echo "Trying again..."
          fi
      
      - name: Ping Root Endpoint (Backup)
        if: always()
        run: |
          echo "ğŸ”„ Backup ping to root endpoint"
          curl -s -o /dev/null -w "Status: %{http_code}\n" --max-time 30 https://claude-sonnet-api.onrender.com/ || echo "âš ï¸ Backup ping failed"
      
      - name: Ping Providers Endpoint (Extra)
        if: always()
        run: |
          echo "ğŸ“¡ Extra ping to providers endpoint"
          curl -s -o /dev/null -w "Status: %{http_code}\n" --max-time 30 https://claude-sonnet-api.onrender.com/providers || echo "âš ï¸ Extra ping failed"
      
      - name: Report Success
        if: success()
        run: |
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
          echo "âœ¨ Keep-alive ping completed successfully!"
          echo "ğŸ¯ API will stay awake for next 15 minutes"
          echo "â° Next ping in 5 minutes"
          echo "â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”"
